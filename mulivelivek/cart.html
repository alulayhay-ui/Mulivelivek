<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Mulivelivek 初鹿部落｜購物車</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    /* 與其他頁面一致的 CSS */
    :root { --bg: #f7f3ec; --bg-soft: #fffdf8; --card: #ffffff; --border: #e3ddcf; --accent: #c58543; --accent-dark: #92572a; --text: #2f2415; --muted: #7b6d5c; }
    * { box-sizing: border-box; }
    body { margin: 0; min-height: 100vh; font-family: system-ui, sans-serif; background: var(--bg); color: var(--text); }
    a { color: inherit; text-decoration: none; }

    .site-header { position: sticky; top: 0; z-index: 20; background: #ffffffdd; backdrop-filter: blur(8px); border-bottom: 1px solid var(--border); }
    .header-inner { max-width: 1100px; margin: 0 auto; padding: 10px 16px; display: flex; align-items: center; justify-content: space-between; }
    .brand-text-main { font-weight: 600; }
    .header-nav { display: flex; gap: 16px; font-size: 0.85rem; color: var(--muted); }
    .header-nav a:hover { color: var(--accent); }

    .page { max-width: 900px; margin: 0 auto; padding: 40px 16px; }
    .cart-shell { background: #fff; border-radius: 16px; border: 1px solid var(--border); padding: 20px; }
    .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px dashed var(--border); }
    .cart-item:last-child { border-bottom: none; }
    .btn { padding: 10px 20px; background: var(--accent); color: #fff; border-radius: 99px; border: none; font-size: 1rem; cursor: pointer; }
    .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--muted); }
    .btn-outline:hover { border-color: var(--accent); color: var(--accent); }
    .actions { margin-top: 20px; display: flex; justify-content: space-between; align-items: center; }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="header-inner">
      <div class="brand-text-main">Mulivelivek</div>
      <nav class="header-nav">
        <a href="index.html">首頁</a>
        <a href="products.html">所有商品</a>
        <a href="gallery.html">部落相簿</a>
        <a href="order-tracking.html">訂單查詢</a>
      </nav>
    </div>
  </header>

  <main class="page">
    <h1 style="margin-top:0;">您的購物車</h1>
    <div class="cart-shell">
      <div id="cartList">
        <!-- JS 會填入商品 -->
        <p style="text-align:center; color:var(--muted);">購物車載入中...</p>
      </div>
      
      <div class="actions">
        <a href="products.html" class="btn btn-outline">繼續購物</a>
        <div style="text-align:right;">
          <div style="margin-bottom:10px; font-weight:600; font-size:1.2rem;">總計: <span id="cartTotal">NT$ 0</span></div>
          <button class="btn" id="checkoutBtn">前往結帳</button>
        </div>
      </div>
    </div>
  </main>

  <script>
    const CART_KEY = 'mulivelivekCart';
    function loadCart() { try { return JSON.parse(localStorage.getItem(CART_KEY) || '[]'); } catch { return []; } }
    
    function render() {
      const cart = loadCart();
      const list = document.getElementById('cartList');
      const totalEl = document.getElementById('cartTotal');
      
      if(cart.length === 0) {
        list.innerHTML = '<p style="text-align:center; padding:20px;">購物車是空的</p>';
        totalEl.textContent = 'NT$ 0';
        return;
      }
      
      let html = '';
      let total = 0;
      cart.forEach((item, idx) => {
        const sub = item.price * item.quantity;
        total += sub;
        html += `
          <div class="cart-item">
            <div>
              <strong>${item.style}</strong>
              <div style="font-size:0.85rem; color:#777;">尺寸: ${item.size} | 數量: ${item.quantity}</div>
            </div>
            <div>NT$ ${sub}</div>
            <button onclick="removeItem(${idx})" style="margin-left:10px; border:none; background:none; color:red; cursor:pointer;">×</button>
          </div>
        `;
      });
      list.innerHTML = html;
      totalEl.textContent = 'NT$ ' + total;
    }

    function removeItem(idx) {
      const cart = loadCart();
      cart.splice(idx, 1);
      localStorage.setItem(CART_KEY, JSON.stringify(cart));
      render();
    }

    // 關鍵連結修正：前往 shipping.html
    document.getElementById('checkoutBtn').addEventListener('click', () => {
      const cart = loadCart();
      if(cart.length === 0) { alert('購物車是空的！'); return; }
      window.location.href = 'shipping.html';
    });

    render();
  </script>
</body>
</html>
